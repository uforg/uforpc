{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "types",
    "procedures"
  ],
  "properties": {
    "version": {
      "const": 1
    },
    "types": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/field"
      }
    },
    "procedures": {
      "type": "object",
      "patternProperties": {
        "^[A-Z][a-zA-Z0-9]*$": {
          "$ref": "#/$defs/procedure"
        }
      },
      "additionalProperties": false
    }
  },
  "$defs": {
    "ruleWithValue": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "value"
      ],
      "properties": {
        "value": {},
        "errorMessage": {
          "type": "string"
        }
      }
    },
    "ruleSimple": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "errorMessage": {
          "type": "string"
        }
      }
    },
    "enumRule": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "values"
      ],
      "properties": {
        "values": {
          "type": "array",
          "minItems": 1,
          "items": {}
        },
        "errorMessage": {
          "type": "string"
        }
      }
    },
    "field": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "anyOf": [
            {
              "enum": [
                "string",
                "int",
                "float",
                "boolean",
                "object",
                "array"
              ]
            },
            {
              "pattern": "^[A-Z][a-zA-Z0-9]*$"
            }
          ]
        },
        "description": {
          "type": "string"
        },
        "rules": {
          "type": "object",
          "properties": {
            "optional": {
              "$ref": "#/$defs/ruleSimple"
            },
            "equals": {
              "$ref": "#/$defs/ruleWithValue"
            },
            "min": {
              "$ref": "#/$defs/ruleWithValue"
            },
            "max": {
              "$ref": "#/$defs/ruleWithValue"
            },
            "contains": {
              "$ref": "#/$defs/ruleWithValue"
            },
            "regex": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "pattern"
              ],
              "properties": {
                "pattern": {
                  "type": "string"
                },
                "errorMessage": {
                  "type": "string"
                }
              }
            },
            "minLen": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "value"
              ],
              "properties": {
                "value": {
                  "type": "integer"
                },
                "errorMessage": {
                  "type": "string"
                }
              }
            },
            "maxLen": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "value"
              ],
              "properties": {
                "value": {
                  "type": "integer"
                },
                "errorMessage": {
                  "type": "string"
                }
              }
            },
            "enum": {
              "$ref": "#/$defs/enumRule"
            },
            "email": {
              "$ref": "#/$defs/ruleSimple"
            },
            "iso8601": {
              "$ref": "#/$defs/ruleSimple"
            },
            "uuid": {
              "$ref": "#/$defs/ruleSimple"
            },
            "json": {
              "$ref": "#/$defs/ruleSimple"
            },
            "lowercase": {
              "$ref": "#/$defs/ruleSimple"
            },
            "uppercase": {
              "$ref": "#/$defs/ruleSimple"
            }
          }
        },
        "fields": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/field"
          }
        },
        "arrayType": {
          "$ref": "#/$defs/field"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "const": "object"
              }
            },
            "required": [
              "type"
            ]
          },
          "then": {
            "required": [
              "fields"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "array"
              }
            },
            "required": [
              "type"
            ]
          },
          "then": {
            "required": [
              "arrayType"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "string"
              }
            }
          },
          "then": {
            "properties": {
              "rules": {
                "properties": {
                  "equals": {
                    "properties": {
                      "value": {
                        "type": "string"
                      }
                    }
                  },
                  "min": false,
                  "max": false
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "int"
              }
            }
          },
          "then": {
            "properties": {
              "rules": {
                "properties": {
                  "equals": {
                    "properties": {
                      "value": {
                        "type": "integer"
                      }
                    }
                  },
                  "enum": {
                    "properties": {
                      "values": {
                        "type": "array",
                        "items": {
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "min": {
                    "properties": {
                      "value": {
                        "type": "integer"
                      }
                    }
                  },
                  "max": {
                    "properties": {
                      "value": {
                        "type": "integer"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "float"
              }
            }
          },
          "then": {
            "properties": {
              "rules": {
                "properties": {
                  "equals": {
                    "properties": {
                      "value": {
                        "type": "number"
                      }
                    }
                  },
                  "enum": {
                    "properties": {
                      "values": {
                        "type": "array",
                        "items": {
                          "type": "number"
                        }
                      }
                    }
                  },
                  "min": {
                    "properties": {
                      "value": {
                        "type": "number"
                      }
                    }
                  },
                  "max": {
                    "properties": {
                      "value": {
                        "type": "number"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "boolean"
              }
            }
          },
          "then": {
            "properties": {
              "rules": {
                "properties": {
                  "equals": {
                    "properties": {
                      "value": {
                        "type": "boolean"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "enum": [
                  "int",
                  "float",
                  "boolean"
                ]
              }
            }
          },
          "then": {
            "properties": {
              "rules": {
                "properties": {
                  "minLen": false,
                  "maxLen": false,
                  "regex": false,
                  "email": false,
                  "iso8601": false,
                  "json": false,
                  "lowercase": false,
                  "uppercase": false
                }
              }
            }
          }
        }
      ]
    },
    "procedure": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "enum": [
            "query",
            "mutation"
          ]
        },
        "description": {
          "type": "string"
        },
        "input": {
          "$ref": "#/$defs/field"
        },
        "output": {
          "$ref": "#/$defs/field"
        },
        "meta": {
          "type": "object",
          "additionalProperties": {
            "type": [
              "string",
              "number",
              "boolean"
            ]
          }
        }
      }
    }
  }
}
